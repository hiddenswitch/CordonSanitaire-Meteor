<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>

    <script>
        /**
         * Created by Shinjini on 3/14/2016.
         */


//        SanitaireMaps.PATHABLE_TILES = [8, 9, 10, 11, 12, 15, 17, 18, 33, 37, 38, 39];
//
//        SanitaireMaps.CROSSWALK_TILES = [8, 9, 10, 11];
//
//        0 = road
//        1 = building
//        2 = intersection


        /*
        5x5 tiles
        */
        var Blocks = {
            SOLID :
                    [
                        [1, 1, 1, 1, 1],
                        [1, 1, 1, 1, 1],
                        [1, 1, 1, 1, 1],
                        [1, 1, 1, 1, 1],
                        [1, 1, 1, 1, 1]
                    ],

            VERTICAL :
                    [
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1]
                ],

            HORIZONTAL :
                    [
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1],
                    [0, 0, 0, 0, 0],
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1]
                ],

            PLUS :
                    [
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [0, 0, 0, 0, 0],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1]
                ],

            T_LEFT :
                    [
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [0, 0, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1]
                ],

            T_RIGHT :
                    [
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 0, 0],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1]
                ],

            T_UP :
                    [
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [0, 0, 0, 0, 0],
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1]
                ],

            T_DOWN :
                    [
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1],
                    [0, 0, 0, 0, 0],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1]
                ],

            UP_LEFT :
                    [
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [0, 0, 0, 1, 1],
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1]
                ],

            UP_RIGHT :
                    [
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 0, 0],
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1]
                ],

            DOWN_RIGHT :
                    [
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1],
                    [1, 1, 0, 0, 0],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1]
                ],

            DOWN_LEFT :
                    [
                    [1, 1, 1, 1, 1],
                    [1, 1, 1, 1, 1],
                    [0, 0, 0, 1, 1],
                    [1, 1, 0, 1, 1],
                    [1, 1, 0, 1, 1]
                ]

        }

        var PathToRight = {
            YES: {
                "HORIZONTAL":.142851,
                "PLUS":.142851,
                "T_LEFT":.142851,
                "T_UP":.142851,
                "T_DOWN":.142851,
                "UP_LEFT":.142851,
                "DOWN_LEFT":.142851
            },
            NO: {
                "SOLID":.2,
                "VERTICAL":.2,
                "T_RIGHT":.2,
                "UP_RIGHT":.2,
                "DOWN_RIGHT":.2
            }
        }

        var PathDown = {
            YES: {
                "VERTICAL":.142851,
                "PLUS":.142851,
                "T_LEFT":.142851,
                "T_RIGHT":.142851,
                "T_UP":.142851,
                "UP_LEFT":.142851,
                "UP_RIGHT":.142851
            },
            NO: {
                "SOLID":.2,
                "HORIZONTAL":.2,
                "T_DOWN":.2,
                "DOWN_RIGHT":.2,
                "DOWN_LEFT":.2
            }
        }

        var BlockSuccessors = {
          "SOLID": {
              right: PathToRight.NO,
              down: PathDown.NO
          },
            "VERTICAL":{
                right: PathToRight.NO,
                down: PathDown.YES
            },
            "HORIZONTAL":{
                right: PathToRight.YES,
                down: PathDown.NO
            },
            "PLUS":{
                right: PathToRight.YES,
                down: PathDown.YES
            },
            "T_LEFT":{
                right: PathToRight.NO,
                down: PathDown.YES
            },
            "T_RIGHT":{
                right: PathToRight.YES,
                down:PathDown.YES
            },
            "T_UP":{
                right: PathToRight.YES,
                down: PathDown.NO
            },
            "T_DOWN":{
                right: PathToRight.YES,
                down: PathDown.YES
            },
            "UP_LEFT":{
                right: PathToRight.NO,
                down: PathDown.NO
            },
            "UP_RIGHT":{
                right: PathToRight.YES,
                down:PathDown.NO
            },
            "DOWN_RIGHT":{
                right: PathToRight.YES,
                down: PathDown.YES
            },
            "DOWN_LEFT":{
                right: PathToRight.NO,
                down: PathDown.YES
            }
        };

        var mapGenerate = function(/*Map Size?*/){
            // 50x50 is 10x10 blocks

            // If at (row, col) = (0, 0), pretend that up and left are SOLID
            // If row = 0, pretend up is SOLID
            // If col = 0, pretend left is SOLID
            var mapSize = 10;
            var map = [];
            for (var row = 0; row < 10; row++){
                map.push([])
                var up; // these are strings eg, "SOLID"
                var left;
                for (var col = 0; col< 10; col++){
                    if (row  == 0){
                        if (col ==0){ // if (i, j) = (0, 0)
                            up = "SOLID";
                            left = "SOLID";
                        } else {
                            up = "SOLID";
                            left = map[row][col-1];
                        }
                    }
                    else if (col == 0){ // will not have the case (i, j) = (0, 0)
                        up = map[row-1][col];
                        left = "SOLID";
                    } else { // all other cases
                        up = map[row-1][col];
                        left = map[row][col-1];
                    }
                    // find intersection
                    var possibilitiesFromUp = BlockSuccessors[up].down;
                    var possibilitiesFromUpKeys = Object.keys(possibilitiesFromUp);
                    var possibilitiesFromLeft = BlockSuccessors[left].right;
                    var possibilities = {};
                    var sumProbabilities = 0;

                    // edge cases
                    var edgeCase = false;
                    if (row == mapSize -1){
                        edgeCase = true;
                        if (col == mapSize - 1){ // bottom right cell
                            var allowed = {
                                "SOLID":.5,
                                "UP_LEFT":.5
                            }
                        } else { // bottom row
                            var allowed = {
                                "SOLID":.2,
                                "HORIZONTAL":.2,
                                "T_UP": .2,
                                "UP_RIGHT":.2,
                                "UP_LEFT":.2
                            }
                        }
                    } else if (col == mapSize -1){ // rightmost Column
                        edgeCase = true;
                        var allowed = {
                            "SOLID":.2,
                            "VERTICAL":.2,
                            "T_LEFT":.2,
                            "UP_LEFT":.2,
                            "DOWN_LEFT":.2
                        }
                    }
                    if (edgeCase){
                        var allowedKeys = Object.keys(allowed);
                        for (var i = 0; i<allowedKeys.length; i++){
                            var key = allowedKeys[i];
                            if ((key in possibilitiesFromLeft)&&(key in possibilitiesFromUp)){
                                var probability = allowed[key]*possibilitiesFromLeft[key]*possibilitiesFromUp[key];
                                sumProbabilities += probability;
                                possibilities[key] = probability;
                            }
                        }
                    } else {
                        for (var i = 0; i<possibilitiesFromUpKeys.length; i++){
                            var key = possibilitiesFromUpKeys[i];
                            if (key in possibilitiesFromLeft){
                                var probability = possibilitiesFromLeft[key]*possibilitiesFromUp[key];
                                sumProbabilities += probability;
                                possibilities[key] = probability;
                            }
                        }
                    }

                    var possibilitiesKeys = Object.keys(possibilities);
                    var possibilitiesProbRanges = [];
                    var probRange = 0;
                    for (var i = 0; i<possibilitiesKeys.length; i++){
                        var key = possibilitiesKeys[i];
                        var newProb = possibilities[key]/sumProbabilities;
                        possibilities[key] = newProb; // don't actually need to do this
                        probRange += newProb;
                        possibilitiesProbRanges.push(probRange);
                    }

                    // get random number
                    var rand = Math.random();
                    var index;
                    for (var i = 0; i<possibilitiesKeys.length; i++){
                        if (rand<possibilitiesProbRanges[i]){
                            index = i;
                            break;
                        }
                    }
                    var newBlock = possibilitiesKeys[index];
                    if (!newBlock){
                        newBlock = "SOLID"; // sometimes happens for the last cell
                        console.log("whaaat?");
                    }
                    map[row].push(newBlock);
                }
            }
            return map
        }


        var mapDecode = function(mapDescription){
            var data = [];
            for (var rowNum = 0; rowNum<mapDescription.length; rowNum++){
                for (var blockRowNum = 0; blockRowNum<5; blockRowNum++){
                    var rowData = [];
                    for (var colNum = 0; colNum<mapDescription[rowNum].length; colNum++){
                        var description = mapDescription[rowNum][colNum];
                        var descriptionArray = Blocks[description];
                        rowData = rowData.concat(descriptionArray[blockRowNum]);
                    }
                    data.push(rowData);
                };
            }
            return data;
        };

        var data = mapDecode(mapGenerate());
//        console.log(data);




        // from http://stackoverflow.com/questions/14964035/how-to-export-javascript-array-info-to-csv-on-client-side
        //var data = [["name1", "city1", "some other info"], ["name2", "city2", "more info"]];
        var csvContent = "data:text/csv;charset=utf-8,";
        data.forEach(function(infoArray, index){

            dataString = infoArray.join(",");
            csvContent += index < data.length ? dataString+ "\n" : dataString;

        });



        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "test10.csv");

        link.click(); // This will download the data file named "{file name}.csv".

// ------------------------------------------ Old Code ------------------------------------------------------------


        //         var data = [
        //                    [2, 0, 0, 0, 0, 0, 0, 2],
        //                    [0, 1, 1, 1, 1, 1, 1, 0],
        //                    [0, 1, 1, 1, 1, 1, 1, 0],
        //                    [2, 0, 0, 0, 0, 0, 0, 2],
        //                    [0, 1, 1, 1, 1, 1, 1, 1],
        //                    [2, 0, 0, 0, 0, 0, 0, 2],
        //                    [0, 1, 1, 1, 1, 1, 1, 0],
        //                    [2, 0, 0, 0, 0, 0, 0, 2]
        //                    ];



        //        var mapBlocks = [];
        //        var row1 = [];
        //        row1.push(Blocks.SOLID, Blocks.DOWN_RIGHT,Blocks.HORIZONTAL, Blocks.T_DOWN, Blocks.HORIZONTAL, Blocks.HORIZONTAL, Blocks.DOWN_LEFT, Blocks.DOWN_RIGHT, Blocks.HORIZONTAL, Blocks.DOWN_LEFT);
        //        var row2 = [];
        //        row2.push(Blocks.DOWN_RIGHT, Blocks.UP_LEFT, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL, Blocks.VERTICAL, Blocks.SOLID, Blocks.VERTICAL);
        //        var row3 = [];
        //        row3.push(Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.T_RIGHT, Blocks.HORIZONTAL, Blocks.HORIZONTAL, Blocks.PLUS, Blocks.UP_LEFT, Blocks.SOLID, Blocks.VERTICAL);
        //        var row4 = [];
        //        row4.push(Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.T_RIGHT, Blocks.HORIZONTAL, Blocks.HORIZONTAL, Blocks.T_LEFT, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL);
        //        var row5 = [];
        //        row5.push(Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.T_RIGHT, Blocks.HORIZONTAL, Blocks.HORIZONTAL, Blocks.T_LEFT)
        //        var row6 = [];
        //        row6.push(Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL);
        //        var row7 = [];
        //        row7.push(Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL);
        //        var row8 = [];
        //        row8.push(Blocks.T_RIGHT, Blocks.HORIZONTAL, Blocks.T_DOWN, Blocks.UP_LEFT, Blocks.SOLID, Blocks.SOLID, Blocks.T_RIGHT, Blocks.HORIZONTAL, Blocks.HORIZONTAL, Blocks.UP_LEFT);
        //        var row9 = [];
        //        row9.push(Blocks.VERTICAL, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.SOLID, Blocks.VERTICAL, Blocks.SOLID, Blocks.SOLID, Blocks.SOLID);
        //        var row10 = [];
        //        row10.push(Blocks.UP_RIGHT, Blocks.HORIZONTAL, Blocks.T_UP, Blocks.HORIZONTAL, Blocks.HORIZONTAL, Blocks.HORIZONTAL, Blocks.UP_LEFT, Blocks.SOLID, Blocks.SOLID, Blocks.SOLID);
        //
        //        mapBlocks.push(row1, row2, row3, row4, row5, row6, row7, row8, row9, row10);

//        var mapBlocks = [];
//        var row1 = [];
//        row1.push("SOLID", "DOWN_RIGHT","HORIZONTAL", "T_DOWN", "HORIZONTAL", "HORIZONTAL", "DOWN_LEFT", "DOWN_RIGHT", "HORIZONTAL", "DOWN_LEFT");
//        var row2 = [];
//        row2.push("DOWN_RIGHT", "UP_LEFT", "SOLID", "VERTICAL", "SOLID", "SOLID", "VERTICAL", "VERTICAL", "SOLID", "VERTICAL");
//        var row3 = [];
//        row3.push("VERTICAL", "SOLID", "SOLID", "T_RIGHT", "HORIZONTAL", "HORIZONTAL", "PLUS", "UP_LEFT", "SOLID", "VERTICAL");
//        var row4 = [];
//        row4.push("VERTICAL", "SOLID", "SOLID", "T_RIGHT", "HORIZONTAL", "HORIZONTAL", "T_LEFT", "SOLID", "SOLID", "VERTICAL");
//        var row5 = [];
//        row5.push("VERTICAL", "SOLID", "SOLID", "VERTICAL", "SOLID", "SOLID", "T_RIGHT", "HORIZONTAL", "HORIZONTAL", "T_LEFT")
//        var row6 = [];
//        row6.push("VERTICAL", "SOLID", "SOLID", "VERTICAL", "SOLID", "SOLID", "VERTICAL", "SOLID", "SOLID", "VERTICAL");
//        var row7 = [];
//        row7.push("VERTICAL", "SOLID", "SOLID", "VERTICAL", "SOLID", "SOLID", "VERTICAL", "SOLID", "SOLID", "VERTICAL");
//        var row8 = [];
//        row8.push("T_RIGHT", "HORIZONTAL", "T_DOWN", "UP_LEFT", "SOLID", "SOLID", "T_RIGHT", "HORIZONTAL", "HORIZONTAL", "UP_LEFT");
//        var row9 = [];
//        row9.push("VERTICAL", "SOLID", "VERTICAL", "SOLID", "SOLID", "SOLID", "VERTICAL", "SOLID", "SOLID", "SOLID");
//        var row10 = [];
//        row10.push("UP_RIGHT", "HORIZONTAL", "T_UP", "HORIZONTAL", "HORIZONTAL", "HORIZONTAL", "UP_LEFT", "SOLID", "SOLID", "SOLID");
//
//        mapBlocks.push(row1, row2, row3, row4, row5, row6, row7, row8, row9, row10);


        //        var data = [];
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.SOLID[j].concat(Blocks.DOWN_RIGHT[j],Blocks.HORIZONTAL[j], Blocks.T_DOWN[j], Blocks.HORIZONTAL[j], Blocks.HORIZONTAL[j], Blocks.DOWN_LEFT[j], Blocks.DOWN_RIGHT[j], Blocks.HORIZONTAL[j], Blocks.DOWN_LEFT[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.DOWN_RIGHT[j].concat(Blocks.UP_LEFT[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.VERTICAL[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.VERTICAL[j].concat(Blocks.SOLID[j], Blocks.SOLID[j], Blocks.T_RIGHT[j], Blocks.HORIZONTAL[j], Blocks.HORIZONTAL[j], Blocks.PLUS[j], Blocks.UP_LEFT[j], Blocks.SOLID[j], Blocks.VERTICAL[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.VERTICAL[j].concat(Blocks.SOLID[j], Blocks.SOLID[j], Blocks.T_RIGHT[j], Blocks.HORIZONTAL[j], Blocks.HORIZONTAL[j], Blocks.T_LEFT[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.VERTICAL[j].concat(Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.T_RIGHT[j], Blocks.HORIZONTAL[j], Blocks.HORIZONTAL[j], Blocks.T_LEFT[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.VERTICAL[j].concat(Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.VERTICAL[j].concat(Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.T_RIGHT[j].concat(Blocks.HORIZONTAL[j], Blocks.T_DOWN[j], Blocks.UP_LEFT[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.T_RIGHT[j], Blocks.HORIZONTAL[j], Blocks.HORIZONTAL[j], Blocks.UP_LEFT[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.VERTICAL[j].concat(Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.VERTICAL[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.SOLID[j]))
        //        };
        //        for (var j = 0; j<5; j++){
        //            data.push(Blocks.UP_RIGHT[j].concat(Blocks.HORIZONTAL[j], Blocks.T_UP[j], Blocks.HORIZONTAL[j], Blocks.HORIZONTAL[j], Blocks.HORIZONTAL[j], Blocks.UP_LEFT[j], Blocks.SOLID[j], Blocks.SOLID[j], Blocks.SOLID[j]))
        //        };
//
//        var mapDecode = function(mapArray){
//            var data = [];
//            for (var rowNum = 0; rowNum<mapArray.length; rowNum++){
//                for (var blockRowNum = 0; blockRowNum<5; blockRowNum++){
//                    var rowData = [];
//                    for (var colNum = 0; colNum<mapArray[rowNum].length; colNum++){
//                        rowData = rowData.concat(mapArray[rowNum][colNum][blockRowNum]);
//                    }
//                    data.push(rowData);
//                };
//            }
//            return data;
//        };


    </script>
</body>
</html>